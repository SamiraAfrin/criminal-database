<html>
<body>
	<form action="{{url_for('test1')}}" method="POST">
		{% for i in range(attrs) %}
			{{ form.name }}
            {{ form.length }}
		{% endfor %}
		<input type="submit" value="Submit">
	</form>
</body>
</html>


@app.route('/dashboard/criminals', methods=['GET', 'POST'])
def showcriminals():
    search = SearchForm()
    insert_info = CriminalForm()

    if not current_user.is_authenticated:
        flash('Please Login first.', 'danger')
        return redirect(url_for('Login'))

    if request.method == 'POST':
        # Updating Criminal Photo
        crim_id = request.form['update_id']
        crim = criminal.query.filter_by(Criminal_id=crim_id).first()
        if crim:
            photo = request.files['photo']
            photo_name = secure_filename(photo.filename)
            crim.Photo = photo_name
            db.session.merge(crim)
            db.session.commit()
            db.session.close()
            flash('Updated Successfully', 'success')
            photo.save('static/criminal_images/'+photo_name)
        else:
            flash('No such Criminal', 'danger')

    # Show All criminal Information to Front-end
    stmt = 'Select c.Photo, c.Criminal_id AS "Criminal ID",c.Name,c.Age,c.Nationality,c.Nid_No AS "NID No.",c.Motive,c.Phone_No AS "Phone No.",c.Address,cr.Remark from criminal c left join criminal_remarks cr on c.Criminal_id = cr.Criminal_id'
    res = criminal.query.all()
    crims = db.session.execute(stmt).fetchall()
    db.session.close()
    return render_template('dashboard-criminal.html', form_i=insert_info, form_s=search, data=crims, head=crims[0].keys())


# Route used to insert a Criminal to the database
@app.route('/dashboard/criminals/insert', methods=['POST'])
def insert_criminal():
    insert_info = CriminalForm()

    if insert_info.validate_on_submit():

        # Storing all criminal information about the criminal
        name = insert_info.name.data
        age = insert_info.age.data
        nationality = insert_info.nationality.data
        motive = insert_info.motive.data
        phone_number = insert_info.phone_number.data
        address = insert_info.address.data
        remark = insert_info.remark.data
        nid_no = insert_info.nid_no.data
        photo_name = None

        if insert_info.photo.data:
            photo_name = secure_filename(insert_info.photo.data.filename)
            insert_info.photo.data.save('static/criminal_images/'+photo_name)

        # Inserting criminal into database
        crim = criminal(Name=name, Age=age, Nationality=nationality,
                        Motive=motive, Phone_No=phone_number, Address=address, NID_No=nid_no, Photo=photo_name)
        db.session.add(crim)
        db.session.commit()
        # Inserting the remark for the criminal that was just added if not empty
        if remark != '':
            crim_remark = criminal_remarks(Criminal_id=crim.Criminal_id, Remark=remark)
            db.session.add(crim_remark)
            db.session.commit()
            db.session.close()
        flash('Insert Successful', 'success')

    return redirect(url_for('showcriminals'))


# Route used to query using photo name
@app.route('/dashboard/criminals/query', methods=['GET', 'POST'])
def query():
    search = SearchForm()
    insert_info = CriminalForm()
    if search.validate_on_submit():
        query = search.query.data
        stmt = "Select Photo, Criminal_id, Name, Age, Nationality, NID_No, Phone_No, Address from criminal where Photo = '"+query+"'"
        data = db.session.execute(stmt).fetchall()
        db.session.close()
        if data:
            return render_template('dashboard-criminal.html', form_i=insert_info, form_s=search, data=data, head=data[0].keys())

    flash('No Photo Found', 'danger')
    return redirect(url_for('showcriminals'))





	# My One
	'''@app.route('/validate',methods=['GET','POST'])
	def validate():
	    clr_form = SecurityForm()
	    if clr_form.validate_on_submit():
	        print("aschi ami")
	        Officer_id=clr_form.Officer_id.data
	        Clearance=clr_form.Clearance.data
	        Off = clr_form.Off.data
	        Cas = clr_form.Cas.data
	        p1 = police_officers.query.filter_by(Officer_id=Off).first()
	        c1 = crime.query.filter_by(Case_No=Cas).first()
	        security_obj = police_officers.query.filter_by(Officer_id=Officer_id).first()
	        if security_obj:
	            security_obj.Clearance = Clearance
	            db.session.merge(security_obj)
	            db.session.commit()
	            stmt='Select * from police_officers'
	            crims = db.session.execute(stmt).fetchall()
	            return redirect(url_for('validate'))
	        elif p1 and c1:
	            stmt1 = 'Select o.Username,o.Officer_id,o.Station,o.Rank,o.Clearance from Users u, police_officers o where o.Username = u.Username and o.officer_id = "'+Off+'"'
	            pol1 = db.session.execute(stmt1).fetchall()
	            stmt2='Select c.Case_No,i.Officer_id  AS Investigated_By , co.Criminal_id,cr.Name AS Criminal_Name,c.Crime_date,c.End_date,c.Address,c.Clearance from  investigate_by i ,crime c, criminal cr, Committed_by co where c.Case_No = co.Case_No AND cr.Criminal_id = co.Criminal_id AND i.Case_No = co.Case_No AND c.Case_No = "'+Cas+'"'
	            crim2 = db.session.execute(stmt2).fetchall()
	            return render_template("admin_security_clearance.html", flag=True, form=clr_form, data1=pol1, head1=pol1[0].keys(), data2=crim2, head2=crim2[0].keys())

	        elif p1:
	            stmt1 = 'Select o.Username,o.Officer_id,o.Station,o.Rank,o.Clearance from Users u, police_officers o where o.Username = u.Username and o.officer_id = "'+Off+'"'
	            pol1 = db.session.execute(stmt1).fetchall()
	            return render_template('admin_security_clearance.html',form=clr_form, data=pol1, head=pol1[0].keys(), flag=False)
	        elif c1:
	            stmt2='Select c.Case_No,i.Officer_id  AS Investigated_By , co.Criminal_id,cr.Name AS Criminal_Name,c.Crime_date,c.End_date,c.Address,c.Clearance from  investigate_by i ,crime c, criminal cr, Committed_by co where c.Case_No = co.Case_No AND cr.Criminal_id = co.Criminal_id AND i.Case_No = co.Case_No AND c.Case_No = "'+Cas+'"'
	            crim2 = db.session.execute(stmt2).fetchall()
	            return render_template('admin_security_clearance.html',form=clr_form, data=crim2, head=crim2[0].keys(), flag=False)

	    stmt1 = 'SELECT * from police_officers'
	    stmt2 = 'select * from crime'
	    pol = db.session.execute(stmt1).fetchall()
	    crim = db.session.execute(stmt2).fetchall()
	    return render_template("admin_security_clearance.html", flag=True, form=clr_form, data1=pol, head1=pol[0].keys(), data2=crim, head2=crim[0].keys(),c=1)



	@app.route ('/search/<keys1>', methods=['GET','POST'])
	def Search(keys1):
	    clr_form = SecurityForm()
	    o1_obj = police_officers.query.filter_by(Officer_id=keys1).first()
	    p1_obj = crime.query.filter_by(Case_No=keys1).first()
	    if o1_obj:
	        stmt1 = 'Select o.Username,o.Officer_id,o.Station,o.Rank,o.Clearance from Users u, police_officers o where o.Username = u.Username and o.officer_id = "'+keys1+'"'
	        pol1 = db.session.execute(stmt1).fetchall()
	        return render_template('admin_security_clearance.html',form=clr_form, data=pol1, head=pol1[0].keys(), flag=False)
	    elif p1_obj:
	        stmt2='Select c.Case_No,i.Officer_id  AS Investigated_By , co.Criminal_id,cr.Name AS Criminal_Name,c.Crime_date,c.End_date,c.Address,c.Clearance from  investigate_by i ,crime c, criminal cr, Committed_by co where c.Case_No = co.Case_No AND cr.Criminal_id = co.Criminal_id AND i.Case_No = co.Case_No AND c.Case_No = "'+keys1+'"'
	        crim2 = db.session.execute(stmt2).fetchall()
	        return render_template('admin_security_clearance.html',form=clr_form, data=crim2, head=crim2[0].keys(), flag=False)
	    return render_template("admin_security_clearance.html", form=clr_form)'''
